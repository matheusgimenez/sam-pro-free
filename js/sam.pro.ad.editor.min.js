var sam=sam||{};(function(n){function s(n){for(var i=[],t=0;t<o.length;t++)n&o[t]&&i.push(t);return i}function h(n,t){for(var r=t,i=0;i<n.length;i++)r|=parseInt(n[i].id,10);return r}function c(n,t,i){for(var u=t,f=parseInt(i,10),r=0;r<n.length;r++)u=u&~parseInt(n[r].id,10);return u&~f}var f,e=options.media,r=options.strings,i=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,u=options.wap,o=[1,2,4,8,8192,16,32,64,128,256,512,1024,2048,16384,4096];sam.media=f={buttonId:"#banner-media",adUrl:"#img",adImgId:"#img_id",adName:"#title",adDesc:"#description",adLink:"#link",adAlt:"#alt",adFallback:"#swf_fallback",btnFallback:"#fallback-code",init:function(){n(this.buttonId).on("click",this.openMediaDialog);n(this.btnFallback).on("click",this.openMediaDialog)},openMediaDialog:function(n){n.preventDefault();var t="#"+n.currentTarget.id;if(this._frame){this._frame.open();return}this._frame=f.frame=wp.media({title:e.title,button:{text:e.button},multiple:!1,library:{type:"image"}});this._frame.state("library").on("select",function(){var n=this.get("selection").single();f.handleMediaAttachment(n,t)});this._frame.open()},handleMediaAttachment:function(t,i){var r=t.toJSON();if(i==this.buttonId)n(this.adUrl).val(r.url),n(this.adImgId).val(r.id),""==n(this.adName).val()&&""!=r.title&&n(this.adName).val(r.title),""==n(this.adDesc).val()&&""!=r.caption&&n(this.adDesc).val(r.caption),""==n(this.adAlt).val()&&""!=r.alt&&n(this.adAlt).val(r.alt);else if(i==this.btnFallback){var u=n(this.adLink).val(),f=u!=""?'<a href="'+u+'">':"",e='<img src="'+r.url+'">',o=u!=""?"<\/a>":"",s=f+e+o;n(this.adFallback).val(s)}}};n(document).ready(function(){var st,ht,k,nt,e,tt,o,it,l,rt,a,ut,v,ft,y,dt,et,ot;n("#tabs").ejTab({enablePersistence:!0});f.init();st=n("#rc-cmf");ht=n("#rc-cmt");n("#amode_false").click(function(){st.show("blind",{direction:"vertical"},500);ht.hide("blind",{direction:"vertical"},500)});n("#amode_true").click(function(){st.hide("blind",{direction:"vertical"},500);ht.show("blind",{direction:"vertical"},500)});var g=n("#ptypes"),b=parseInt(g.val(),10),fr=n("#page-types").ejTreeView({showCheckbox:!0,checkedNodes:s(g.val()),nodeCheck:function(n){b=h(n.currentCheckedNodes,b,n.parentId);g.val(b)},nodeUncheck:function(n){b=c(n.currentUncheckedNodes,b,n.parentId);g.val(b)}}).data("ejTreeView");fr.expandAll();k=n("#rc-vt0");n("input:radio[name=ptype]").on("click",function(){var t=n("input:radio[name=ptype]:checked").val();t==0?k.is(":visible")&&k.hide("blind",{direction:"vertical"},500):t==1&&k.is(":hidden")&&k.show("blind",{direction:"vertical"},500)});var gt=n("#rc-posts"),ni=n("#eposts"),ti=n("#rc-cats"),ii=n("#ecats"),ri=n("#rc-tags"),ui=n("#etags"),fi=n("#rc-authors"),ei=n("#eauthors"),oi=n("#rc-tax"),si=n("#etax"),hi=n("#rc-types"),ci=n("#etypes"),li=n("#rc-schedule"),ai=n("#schedule"),vi=n("#rc-hl"),yi=n("#limit_hits"),pi=n("#rc-cl"),wi=n("#limit_clicks");ni.on("click",function(){ni.is(":checked")?gt.show("blind",{direction:"vertical"},500):gt.hide("blind",{direction:"vertical"},500)});ii.on("click",function(){ii.is(":checked")?ti.show("blind",{direction:"vertical"},500):ti.hide("blind",{direction:"vertical"},500)});ui.on("click",function(){ui.is(":checked")?ri.show("blind",{direction:"vertical"},500):ri.hide("blind",{direction:"vertical"},500)});ei.on("click",function(){ei.is(":checked")?fi.show("blind",{direction:"vertical"},500):fi.hide("blind",{direction:"vertical"},500)});si.on("click",function(){si.is(":checked")?oi.show("blind",{direction:"vertical"},500):oi.hide("blind",{direction:"vertical"},500)});ci.on("click",function(){ci.is(":checked")?hi.show("blind",{direction:"vertical"},500):hi.hide("blind",{direction:"vertical"},500)});ai.on("click",function(){ai.is(":checked")?li.show("blind",{direction:"vertical"},500):li.hide("blind",{direction:"vertical"},500)});yi.on("click",function(){yi.is(":checked")?vi.show("blind",{direction:"vertical"},500):vi.hide("blind",{direction:"vertical"},500)});wi.on("click",function(){wi.is(":checked")?pi.show("blind",{direction:"vertical"},500):pi.hide("blind",{direction:"vertical"},500)});var w={width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1},ct=n("#postsDialog").ejDialog(w).data("ejDialog"),lt=n("#catsDialog").ejDialog(w).data("ejDialog"),at=n("#tagsDialog").ejDialog(w).data("ejDialog"),vt=n("#authorsDialog").ejDialog(w).data("ejDialog"),yt=n("#taxDialog").ejDialog(w).data("ejDialog"),pt=n("#typesDialog").ejDialog(w).data("ejDialog"),d=n("#posts"),p=new Selectors;p.sid=d.val();nt=n("#cats");e=new Selectors;e.sid=nt.val();tt=n("#tags");o=new Selectors;o.sid=tt.val();it=n("#authors");l=new Selectors;l.sid=it.val();rt=n("#taxes");a=new Selectors;a.sid=rt.val();ut=n("#types");v=new Selectors;v.sid=ut.val();var er=encodeURI(r.posts),or=encodeURI(r.page),sr=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_posts&cstr="+options.data.custList+"&wap="+u+"&sp="+er+"&spg="+or+(d.val()==""?"":"&ids="+d.val()),requestType:"json",adaptor:new ej.UrlAdaptor}),hr=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_cats&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),cr=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_tags&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),lr=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_authors&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),ar=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_taxes&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),vr=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_types&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),yr=n("#postsGrid").ejGrid({dataSource:sr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"type",headerText:t.type,width:250}],rowSelected:function(n){if(!p.service){p.page=n.model.pageSettings.currentPage;var t=p.pids[p.page].slice(0),i=t.indexOf(n.data.id);i>-1?p.removePid(n.data.id):p.pids=n.data.id}},actionComplete:function(n){var t,i,r=p.ids.slice(0);if(p.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].id&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(p.page=n.currentPage,p.pids=this.model.currentViewData[t].id):n.requestType=="refresh"&&(p.page=1,p.pids=this.model.currentViewData[t].id));p.service=!1}}).data("ejGrid"),pr=n("#catsGrid").ejGrid({dataSource:hr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!e.service){e.page=n.model.pageSettings.currentPage;var t=e.pids[e.page].slice(0),i=t.indexOf(n.data.slug);i>-1?e.removePid(n.data.slug):e.pids=n.data.slug}},actionComplete:function(n){var t,i,r=e.ids.slice(0);if(e.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(e.page=n.currentPage,e.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(e.page=1,e.pids=this.model.currentViewData[t].slug));e.service=!1}}).data("ejGrid"),wr=n("#tagsGrid").ejGrid({dataSource:cr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!o.service){o.page=n.model.pageSettings.currentPage;var t=o.pids[o.page].slice(0),i=t.indexOf(n.data.slug);i>-1?o.removePid(n.data.slug):o.pids=n.data.slug}},actionComplete:function(n){var t,i,r=o.ids.slice(0);if(o.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(o.page=n.currentPage,o.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(o.page=1,o.pids=this.model.currentViewData[t].slug));o.service=!1}}).data("ejGrid"),br=n("#authorsGrid").ejGrid({dataSource:lr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!l.service){l.page=n.model.pageSettings.currentPage;var t=l.pids[l.page].slice(0),i=t.indexOf(n.data.slug);i>-1?l.removePid(n.data.slug):l.pids=n.data.slug}},actionComplete:function(n){var t,i,r=l.ids.slice(0);if(l.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(l.page=n.currentPage,l.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(l.page=1,l.pids=this.model.currentViewData[t].slug));l.service=!1}}).data("ejGrid"),kr=n("#taxGrid").ejGrid({dataSource:ar,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.termName,width:480},{field:"ctax_name",headerText:t.ctName,width:250},{field:"slug",headerText:t.slug,visible:!1}],rowSelected:function(n){if(!a.service){a.page=n.model.pageSettings.currentPage;var t=a.pids[a.page].slice(0),i=t.indexOf(n.data.slug);i>-1?a.removePid(n.data.slug):a.pids=n.data.slug}},actionComplete:function(n){var t,i,r=a.ids.slice(0);if(a.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(a.page=n.currentPage,a.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(a.page=1,a.pids=this.model.currentViewData[t].slug));a.service=!1}}).data("ejGrid"),dr=n("#typesGrid").ejGrid({dataSource:vr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:[{field:"title",headerText:t.ctt,width:480},{field:"slug",headerText:t.ctSlug,width:250}],rowSelected:function(n){if(!v.service){v.page=n.model.pageSettings.currentPage;var t=v.pids[v.page].slice(0),i=t.indexOf(n.data.slug);i>-1?v.removePid(n.data.slug):v.pids=n.data.slug}},actionComplete:function(n){var t,i,r=v.ids.slice(0);if(v.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(v.page=n.currentPage,v.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(v.page=1,v.pids=this.model.currentViewData[t].slug));v.service=!1}}).data("ejGrid");n("#cancel-posts").on("click",function(){ct.close()});n("#select-posts").on("click",function(){d.val(p.sid);ct.close()});n("#showPosts").on("click",function(n){n.preventDefault();p.sid=d.val();yr.refreshContent();ct.open()});n("#cancel-cats").on("click",function(){lt.close()});n("#select-cats").on("click",function(){nt.val(e.sid);lt.close()});n("#showCats").on("click",function(n){n.preventDefault();e.sid=nt.val();pr.refreshContent();lt.open()});n("#cancel-tags").on("click",function(){at.close()});n("#select-tags").on("click",function(){tt.val(o.sid);at.close()});n("#showTags").on("click",function(n){n.preventDefault();o.sid=tt.val();wr.refreshContent();at.open()});n("#cancel-authors").on("click",function(){vt.close()});n("#select-authors").on("click",function(){it.val(l.sid);vt.close()});n("#showAuthors").on("click",function(n){n.preventDefault();l.sid=it.val();br.refreshContent();vt.open()});n("#cancel-tax").on("click",function(){yt.close()});n("#select-tax").on("click",function(){rt.val(a.sid);yt.close()});n("#showTaxes").on("click",function(n){n.preventDefault();a.sid=rt.val();kr.refreshContent();yt.open()});n("#cancel-types").on("click",function(){pt.close()});n("#select-types").on("click",function(){ut.val(v.sid);pt.close()});n("#showTypes").on("click",function(n){n.preventDefault();v.sid=ut.val();dr.refreshContent();pt.open()});var bi=n("#sdate"),ki=n("#fdate"),fu=n("#startDate").ejDateTimePicker({width:250,locale:i,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:bi.val(),change:function(n){bi.val(n.value)}}).data("ejDateTimePicker"),eu=n("#finishDate").ejDateTimePicker({width:250,locale:i,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:ki.val(),change:function(n){ki.val(n.value)}}).data("ejDateTimePicker"),di=n("#custom-users"),gr=n("input:radio[name=users]"),gi=n("#x-reg-users"),nr=n("#users_reg"),tr=n("#x-view-users"),ir=n("#xusers");gr.on("click",function(){var t=n("input:radio[name=users]:checked").val();t==0?di.hide("blind",{direction:"vertical"},500):di.show("blind",{direction:"vertical"},500)});nr.on("click",function(){nr.is(":checked")?gi.show("blind",{direction:"vertical"},500):gi.hide("blind",{direction:"vertical"},500)});ir.on("click",function(){ir.is(":checked")?tr.show("blind",{direction:"vertical"},500):tr.hide("blind",{direction:"vertical"},500)});ft=n("#xvusers");y=new Selectors;y.sid=ft.val();var wt=n("#usersDialog").ejDialog(w).data("ejDialog"),nu="&subscriber="+encodeURI(r.subscriber)+"&contributor="+encodeURI(r.contributor)+"&author="+encodeURI(r.author)+"&editor="+encodeURI(r.editor)+"&admin="+encodeURI(r.admin)+"&sadmin="+encodeURI(r.superAdmin),tu=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_users&wap="+u+nu,requestType:"json",adaptor:new ej.UrlAdaptor}),iu=n("#usersGrid").ejGrid({dataSource:tu,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.display,width:330},{field:"slug",headerText:t.user,width:250},{field:"role",headerText:t.role,width:150}],rowSelected:function(n){if(!y.service){y.page=n.model.pageSettings.currentPage;var t=y.pids[y.page].slice(0),i=t.indexOf(n.data.slug);i>-1?y.removePid(n.data.slug):y.pids=n.data.slug}},actionComplete:function(n){var t,i,r=y.ids.slice(0);if(y.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(y.page=n.currentPage,y.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(y.page=1,y.pids=this.model.currentViewData[t].slug));y.service=!1}}).data("ejGrid");n("#cancel-users").on("click",function(){wt.close()});n("#select-users").on("click",function(){ft.val(y.sid);wt.close()});n("#showXUsers").on("click",function(n){n.preventDefault();y.sid=ft.val();iu.refreshContent();wt.open()});var ru=options.advertisers,bt=n("#advertsDialog").ejDialog(w).data("ejDialog"),uu=n("#advertsGrid").ejGrid({dataSource:ej.DataManager(ru),locale:i,allowSorting:!0,allowSelection:!0,allowFiltering:!0,filterSettings:{filterType:"menu"},selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"owner",headerText:t.nick},{field:"owner_name",headerText:t.display},{field:"owner_mail",headerText:t.mail}]}).data("ejGrid");n("#select-adverts").on("click",function(){var i=uu.model.selectedRecords,t;i.length==1&&(t=i[0],n("#owner").val(t.owner),n("#owner_name").val(t.owner_name),n("#owner_mail").val(t.owner_mail));bt.close()});n("#cancel-adverts").on("click",function(){bt.close()});n("#showAdvertisers").on("click",function(n){n.preventDefault();bt.open()});var rr=n("#swf"),ur=n("#swf-params"),kt=n("#link"),ou=n("#alt");rr.on("click",function(){rr.is(":checked")?ur.show("blind",{direction:"vertical"},500):ur.hide("blind",{direction:"vertical"},500)});et=n("#click-tag");ot=n("#swf_vars");kt.on("change",function(){this.value==""?et.prop("disabled",!0):et.prop("disabled",!1)});et.on("click",function(n){n.preventDefault();var t=ot.val();dt=kt.val();""==t?ot.val('{clickTAG: escape("'+dt+'")}'):ot.val(t.replace("}",', clickTAG: escape("'+dt+'")}'));kt.val("")})})})(jQuery)